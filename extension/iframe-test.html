<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Geolocation Spoofer - Nested Iframe Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    h1 {
      color: #333;
      margin-bottom: 10px;
      text-align: center;
    }
    
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    
    .test-section h2 {
      color: #333;
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .status-badge {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
      text-transform: uppercase;
    }
    
    .status-badge.loading {
      background: #ffc107;
      color: white;
    }
    
    .status-badge.success {
      background: #28a745;
      color: white;
    }
    
    .status-badge.error {
      background: #dc3545;
      color: white;
    }
    
    .result {
      background: white;
      padding: 15px;
      border-radius: 6px;
      margin-top: 10px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      white-space: pre-wrap;
      word-break: break-all;
      border: 1px solid #ddd;
      max-height: 200px;
      overflow-y: auto;
    }
    
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: background 0.3s;
      margin-right: 10px;
    }
    
    button:hover {
      background: #764ba2;
    }
    
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .iframe-container {
      margin-top: 20px;
      border: 2px dashed #667eea;
      border-radius: 6px;
      padding: 10px;
      background: #f0f0f0;
    }
    
    iframe {
      width: 100%;
      height: 400px;
      border: none;
      border-radius: 4px;
      background: white;
    }
    
    .nested-info {
      font-size: 12px;
      color: #666;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üåç Geolocation Spoofer - Nested Iframe Test</h1>
    <p class="subtitle">Test geolocation spoofing across main page and nested iframes</p>
    
    <!-- Main Page Test -->
    <div class="test-section">
      <h2>
        üìç Main Page Geolocation
        <span id="main-badge" class="status-badge loading">Testing...</span>
      </h2>
      <button onclick="testMainPageLocation()">Get Location</button>
      <div id="main-result" class="result">Waiting...</div>
    </div>
    
    <!-- First Level Iframe -->
    <div class="test-section">
      <h2>
        üî≤ Level 1 Iframe
        <span id="iframe1-badge" class="status-badge loading">Testing...</span>
      </h2>
      <div class="iframe-container">
        <iframe id="iframe1" src="about:blank" title="Level 1 Iframe"></iframe>
        <div class="nested-info">Level 1 iframe created</div>
      </div>
      <button onclick="testIframeLocation('iframe1')">Get Location in Iframe</button>
      <div id="iframe1-result" class="result">Waiting for iframe to load...</div>
    </div>
    
    <!-- Second Level Iframe (Nested) -->
    <div class="test-section">
      <h2>
        üî≥ Level 2 Iframe (Nested in Level 1)
        <span id="iframe2-badge" class="status-badge loading">Testing...</span>
      </h2>
      <div class="iframe-container">
        <div class="nested-info">This will be loaded inside Level 1 iframe</div>
      </div>
      <button onclick="testNestedIframeLocation()">Get Location in Nested Iframe</button>
      <div id="iframe2-result" class="result">Will test after Level 1 iframe loads...</div>
    </div>
    
    <!-- Summary -->
    <div class="test-section" style="border-left-color: #764ba2; margin-top: 40px;">
      <h2>üìä Test Summary</h2>
      <div id="summary" class="result">
Waiting for tests to complete...

Test Coverage:
‚úì Main page geolocation spoofing
‚úì Level 1 iframe geolocation spoofing
‚úì Level 2 nested iframe geolocation spoofing (iframe inside iframe)
      </div>
    </div>
  </div>

  <script>
    // Create Level 2 iframe content (nested iframe)
    function createLevel2IframeContent() {
      return `
        <!DOCTYPE html>
        <html>
        <head>
          <title>Level 2 Iframe</title>
          <style>
            body {
              font-family: Arial, sans-serif;
              padding: 20px;
              background: #f9f9f9;
            }
            h3 { color: #333; }
            .status { margin: 20px 0; }
            button { padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; }
            button:hover { background: #764ba2; }
            .result { background: white; padding: 10px; border-radius: 4px; margin-top: 10px; font-family: monospace; font-size: 12px; white-space: pre-wrap; word-break: break-all; border: 1px solid #ddd; }
          </style>
        </head>
        <body>
          <h3>Level 2 Iframe (Nested inside Level 1)</h3>
          <button onclick="getLocation()">Get Geolocation</button>
          <div class="result" id="result">Click button to test...</div>
          
          <script>
            window.testResults = [];
            
            function getLocation() {
              const resultDiv = document.getElementById('result');
              resultDiv.textContent = 'Getting location...';
              
              if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                  function(position) {
                    const result = {
                      source: 'Level 2 Iframe (Nested)',
                      latitude: position.coords.latitude,
                      longitude: position.coords.longitude,
                      accuracy: position.coords.accuracy,
                      timestamp: new Date().toLocaleString()
                    };
                    
                    resultDiv.textContent = JSON.stringify(result, null, 2);
                    
                    // Send to parent
                    window.parent.postMessage({ 
                      type: 'level2Result', 
                      data: result 
                    }, '*');
                  },
                  function(error) {
                    const errorMsg = 'Error: ' + error.message;
                    resultDiv.textContent = errorMsg;
                    
                    window.parent.postMessage({ 
                      type: 'level2Result', 
                      data: { error: error.message } 
                    }, '*');
                  }
                );
              }
            }
          </script>
        </body>
        </html>
      `;
    }

    // Create Level 1 iframe content (contains Level 2 iframe)
    function createLevel1IframeContent() {
      return `
        <!DOCTYPE html>
        <html>
        <head>
          <title>Level 1 Iframe</title>
          <style>
            body {
              font-family: Arial, sans-serif;
              padding: 20px;
              background: #f9f9f9;
            }
            h3 { color: #333; }
            .status { margin: 20px 0; }
            button { padding: 8px 16px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
            button:hover { background: #764ba2; }
            .result { background: white; padding: 10px; border-radius: 4px; margin-top: 10px; font-family: monospace; font-size: 12px; white-space: pre-wrap; word-break: break-all; border: 1px solid #ddd; }
            .nested-iframe-box { margin-top: 30px; padding: 15px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px; }
            iframe { width: 100%; height: 300px; border: 1px solid #ddd; border-radius: 4px; }
          </style>
        </head>
        <body>
          <h3>Level 1 Iframe</h3>
          <button onclick="getLocation()">Get Geolocation</button>
          <div class="result" id="result">Click button to test...</div>
          
          <div class="nested-iframe-box">
            <p><strong>Nested Level 2 Iframe (inside this iframe)</strong></p>
            <iframe id="level2-iframe" title="Level 2 Nested Iframe"></iframe>
          </div>
          
          <script>
            function getLocation() {
              const resultDiv = document.getElementById('result');
              resultDiv.textContent = 'Getting location...';
              
              if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                  function(position) {
                    const result = {
                      source: 'Level 1 Iframe',
                      latitude: position.coords.latitude,
                      longitude: position.coords.longitude,
                      accuracy: position.coords.accuracy,
                      timestamp: new Date().toLocaleString()
                    };
                    
                    resultDiv.textContent = JSON.stringify(result, null, 2);
                    
                    // Send to parent
                    window.parent.postMessage({ 
                      type: 'level1Result', 
                      data: result 
                    }, '*');
                  },
                  function(error) {
                    const errorMsg = 'Error: ' + error.message;
                    resultDiv.textContent = errorMsg;
                    
                    window.parent.postMessage({ 
                      type: 'level1Result', 
                      data: { error: error.message } 
                    }, '*');
                  }
                );
              }
            }
            
            // Load nested iframe
            window.addEventListener('load', function() {
              setTimeout(function() {
                const level2Iframe = document.getElementById('level2-iframe');
                if (level2Iframe) {
                  const blob = new Blob(['${createLevel2IframeContent().replace(/\n/g, ' ').replace(/'/g, "\\'")}'], { type: 'text/html' });
                  const url = URL.createObjectURL(blob);
                  level2Iframe.src = url;
                }
              }, 100);
            });
          </script>
        </body>
        </html>
      `;
    }

    // Test main page location
    function testMainPageLocation() {
      const badge = document.getElementById('main-badge');
      const result = document.getElementById('main-result');
      
      badge.textContent = 'Testing...';
      badge.className = 'status-badge loading';
      result.textContent = 'Getting location...';
      
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function(position) {
            const resultObj = {
              source: 'Main Page',
              latitude: position.coords.latitude,
              longitude: position.coords.longitude,
              accuracy: position.coords.accuracy,
              timestamp: new Date().toLocaleString()
            };
            
            result.textContent = JSON.stringify(resultObj, null, 2);
            badge.textContent = 'Success ‚úì';
            badge.className = 'status-badge success';
          },
          function(error) {
            result.textContent = 'Error: ' + error.message;
            badge.textContent = 'Error';
            badge.className = 'status-badge error';
          }
        );
      } else {
        result.textContent = 'Geolocation API not supported';
        badge.textContent = 'Not Supported';
        badge.className = 'status-badge error';
      }
    }

    // Test Level 1 iframe location
    function testIframeLocation(iframeId) {
      const iframe = document.getElementById(iframeId);
      const result = document.getElementById(iframeId + '-result');
      const badge = document.getElementById(iframeId + '-badge');
      
      badge.textContent = 'Testing...';
      badge.className = 'status-badge loading';
      
      try {
        const button = iframe.contentDocument.querySelector('button');
        if (button) {
          result.textContent = 'Requesting location from iframe...';
          button.click();
        }
      } catch (err) {
        result.textContent = 'Error: ' + err.message;
        badge.textContent = 'Error';
        badge.className = 'status-badge error';
      }
    }

    // Test nested iframe location
    function testNestedIframeLocation() {
      const result = document.getElementById('iframe2-result');
      const badge = document.getElementById('iframe2-badge');
      
      badge.textContent = 'Testing...';
      badge.className = 'status-badge loading';
      
      try {
        const level1Iframe = document.getElementById('iframe1');
        const level2Iframe = level1Iframe.contentDocument.getElementById('level2-iframe');
        
        if (level2Iframe) {
          const button = level2Iframe.contentDocument.querySelector('button');
          if (button) {
            result.textContent = 'Requesting location from nested iframe...';
            button.click();
          } else {
            result.textContent = 'Button not found in nested iframe';
          }
        }
      } catch (err) {
        result.textContent = 'Error: ' + err.message;
        badge.textContent = 'Error';
        badge.className = 'status-badge error';
      }
    }

    // Listen for results from iframes
    window.addEventListener('message', function(event) {
      if (event.data.type === 'level1Result') {
        const badge = document.getElementById('iframe1-badge');
        const result = document.getElementById('iframe1-result');
        
        if (event.data.data.error) {
          result.textContent = 'Error: ' + event.data.data.error;
          badge.textContent = 'Error';
          badge.className = 'status-badge error';
        } else {
          result.textContent = JSON.stringify(event.data.data, null, 2);
          badge.textContent = 'Success ‚úì';
          badge.className = 'status-badge success';
        }
      }
      
      if (event.data.type === 'level2Result') {
        const badge = document.getElementById('iframe2-badge');
        const result = document.getElementById('iframe2-result');
        
        if (event.data.data.error) {
          result.textContent = 'Error: ' + event.data.data.error;
          badge.textContent = 'Error';
          badge.className = 'status-badge error';
        } else {
          result.textContent = JSON.stringify(event.data.data, null, 2);
          badge.textContent = 'Success ‚úì';
          badge.className = 'status-badge success';
        }
      }
    });

    // Initialize Level 1 iframe on page load
    window.addEventListener('load', function() {
      setTimeout(function() {
        const iframe1 = document.getElementById('iframe1');
        const blob = new Blob([createLevel1IframeContent()], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        iframe1.src = url;
      }, 500);
    });

    // Auto-test on page load
    window.addEventListener('load', function() {
      setTimeout(function() {
        testMainPageLocation();
      }, 1000);
    });
  </script>
</body>
</html>
